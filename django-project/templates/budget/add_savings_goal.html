{% extends 'base.html' %}

{% block title %}Add Savings Goal - Budget Planner{% endblock %}

{% block content %}
<div class="row justify-content-center">
  <div class="col-md-8">
    <div class="card">
      <div class="card-header">
        <h3><i class="fas fa-plus"></i> Add New Savings Goal</h3>
        <p class="text-muted mb-0">
          Set a financial target and track your progress
        </p>
      </div>
      <div class="card-body">
        <form method="post">
          {% csrf_token %}

          <div class="mb-3">
            <label for="{{ form.title.id_for_label }}" class="form-label"
              >Goal Title *</label
            >
            {{ form.title }} {% if form.title.errors %}
            <div class="invalid-feedback d-block">{{ form.title.errors }}</div>
            {% endif %}
            <div class="form-text">
              Give your savings goal a descriptive name (e.g., "Emergency Fund",
              "Vacation")
            </div>
          </div>

          <div class="row">
            <div class="col-md-6 mb-3">
              <label
                for="{{ form.target_amount.id_for_label }}"
                class="form-label"
                >Target Amount *</label
              >
              <div class="input-group">
                <span class="input-group-text">$</span>
                {{ form.target_amount }}
              </div>
              {% if form.target_amount.errors %}
              <div class="invalid-feedback d-block">
                {{ form.target_amount.errors }}
              </div>
              {% endif %}
            </div>
            <div class="col-md-6 mb-3">
              <label
                for="{{ form.current_amount.id_for_label }}"
                class="form-label"
                >Current Amount</label
              >
              <div class="input-group">
                <span class="input-group-text">$</span>
                {{ form.current_amount }}
              </div>
              {% if form.current_amount.errors %}
              <div class="invalid-feedback d-block">
                {{ form.current_amount.errors }}
              </div>
              {% endif %}
              <div class="form-text">
                How much have you already saved towards this goal?
              </div>
            </div>
          </div>

          <div class="mb-3">
            <label for="{{ form.target_date.id_for_label }}" class="form-label"
              >Target Date *</label
            >
            {{ form.target_date }} {% if form.target_date.errors %}
            <div class="invalid-feedback d-block">
              {{ form.target_date.errors }}
            </div>
            {% endif %}
            <div class="form-text">When do you want to achieve this goal?</div>
          </div>

          <div class="d-flex justify-content-between">
            <a href="{% url 'savings_goals' %}" class="btn btn-secondary">
              <i class="fas fa-arrow-left"></i> Back to Goals
            </a>
            <button type="submit" class="btn btn-primary">
              <i class="fas fa-save"></i> Create Goal
            </button>
          </div>
        </form>
      </div>
    </div>

    <!-- Quick Tips Card -->
    <div class="card mt-4">
      <div class="card-header">
        <h5><i class="fas fa-lightbulb"></i> Savings Tips</h5>
      </div>
      <div class="card-body">
        <div class="row">
          <div class="col-md-6">
            <ul class="list-unstyled">
              <li class="mb-2">
                <i class="fas fa-check text-success"></i> Start with small,
                achievable goals
              </li>
              <li class="mb-2">
                <i class="fas fa-check text-success"></i> Set realistic
                timelines
              </li>
              <li class="mb-2">
                <i class="fas fa-check text-success"></i> Automate your savings
              </li>
            </ul>
          </div>
          <div class="col-md-6">
            <ul class="list-unstyled">
              <li class="mb-2">
                <i class="fas fa-check text-success"></i> Track your progress
                regularly
              </li>
              <li class="mb-2">
                <i class="fas fa-check text-success"></i> Celebrate milestones
              </li>
              <li class="mb-2">
                <i class="fas fa-check text-success"></i> Adjust goals as needed
              </li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %} {% block extra_js %}
<script>
  document.addEventListener("DOMContentLoaded", function () {
    // Set minimum date to today
    const targetDateField = document.querySelector('input[type="date"]');
    if (targetDateField) {
      const today = new Date().toISOString().split("T")[0];
      targetDateField.setAttribute("min", today);
    }

    // Add Bootstrap classes to form fields
    const formFields = document.querySelectorAll(
      'input[type="text"], input[type="number"], input[type="date"], textarea'
    );
    formFields.forEach((field) => {
      field.classList.add("form-control");
    });

    // Calculate target monthly savings
    const targetAmountField = document.getElementById(
      "{{ form.target_amount.id_for_label }}"
    );
    const currentAmountField = document.getElementById(
      "{{ form.current_amount.id_for_label }}"
    );
    const targetDateInput = document.getElementById(
      "{{ form.target_date.id_for_label }}"
    );

    function calculateMonthlyTarget() {
      const targetAmount = parseFloat(targetAmountField.value) || 0;
      const currentAmount = parseFloat(currentAmountField.value) || 0;
      const targetDate = new Date(targetDateInput.value);
      const today = new Date();

      if (targetAmount > 0 && targetDate > today) {
        const monthsRemaining = Math.ceil(
          (targetDate - today) / (1000 * 60 * 60 * 24 * 30)
        );
        const remainingAmount = targetAmount - currentAmount;
        const monthlyTarget = remainingAmount / monthsRemaining;

        if (monthlyTarget > 0) {
          // You could add a display element to show this calculation
          console.log(`Monthly savings needed: $${monthlyTarget.toFixed(2)}`);
        }
      }
    }

    if (targetAmountField && currentAmountField && targetDateInput) {
      [targetAmountField, currentAmountField, targetDateInput].forEach(
        (field) => {
          field.addEventListener("change", calculateMonthlyTarget);
        }
      );
    }
  });
</script>
{% endblock %}
