{% extends 'base.html' %}
{% load budget_extras %}

{% block title %}Budget Overview - Budget Planner{% endblock %}

{% block extra_css %}
<style>
  .gradient-card {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border: none;
    border-radius: 15px;
    box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
    transition: transform 0.3s ease, box-shadow 0.3s ease;
  }

  .gradient-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 15px 30px rgba(0, 0, 0, 0.15);
  }

  .gradient-card-success {
    background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
  }

  .gradient-card-danger {
    background: linear-gradient(135deg, #fc466b 0%, #3f5efb 100%);
  }

  .gradient-card-warning {
    background: linear-gradient(135deg, #fdbb2d 0%, #22c1c3 100%);
  }

  .budget-item {
    background: linear-gradient(135deg, #ffffff 0%, #f8f9fc 100%);
    border-radius: 15px;
    border: 1px solid rgba(255, 255, 255, 0.1);
    box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
  }

  .budget-item::before {
    content: "";
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(
      90deg,
      transparent,
      rgba(255, 255, 255, 0.4),
      transparent
    );
    transition: left 0.5s ease;
  }

  .budget-item:hover::before {
    left: 100%;
  }

  .budget-item:hover {
    transform: translateY(-2px);
    box-shadow: 0 12px 24px rgba(0, 0, 0, 0.15);
  }

  .progress-animated {
    background: rgba(255, 255, 255, 0.3);
    border-radius: 10px;
    overflow: hidden;
    box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.1);
  }

  .progress-bar-animated {
    border-radius: 10px;
    position: relative;
    overflow: hidden;
    font-weight: bold;
    text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3);
  }

  .progress-bar-animated::after {
    content: "";
    position: absolute;
    top: 0;
    left: 0;
    bottom: 0;
    right: 0;
    background-image: linear-gradient(
      45deg,
      rgba(255, 255, 255, 0.3) 25%,
      transparent 25%,
      transparent 50%,
      rgba(255, 255, 255, 0.3) 50%,
      rgba(255, 255, 255, 0.3) 75%,
      transparent 75%,
      transparent
    );
    background-size: 1rem 1rem;
    animation: move 2s linear infinite;
  }

  @keyframes move {
    0% {
      background-position: 0 0;
    }
    100% {
      background-position: 1rem 1rem;
    }
  }

  .category-icon {
    font-size: 2.5rem;
    text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
    filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.2));
  }

  .tip-card {
    background: linear-gradient(135deg, #ffffff 0%, #f8f9fc 100%);
    border: none;
    border-radius: 15px;
    box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
    transition: transform 0.3s ease, box-shadow 0.3s ease;
  }

  .tip-card:hover {
    transform: translateY(-3px);
    box-shadow: 0 12px 24px rgba(0, 0, 0, 0.15);
  }

  .stat-icon {
    background: rgba(255, 255, 255, 0.2);
    border-radius: 50%;
    width: 80px;
    height: 80px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 2rem;
    backdrop-filter: blur(10px);
  }

  .stat-mini {
    padding: 1rem;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 10px;
    backdrop-filter: blur(10px);
    transition: all 0.3s ease;
  }

  .stat-mini:hover {
    background: rgba(255, 255, 255, 0.2);
    transform: scale(1.05);
  }

  .page-header {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    border-radius: 20px;
    margin-bottom: 2rem;
    padding: 2.5rem;
    box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
    position: relative;
    overflow: hidden;
  }

  .page-header::before {
    content: "";
    position: absolute;
    top: -50%;
    right: -50%;
    width: 200%;
    height: 200%;
    background: radial-gradient(
      circle,
      rgba(255, 255, 255, 0.1) 0%,
      transparent 70%
    );
    animation: float 6s ease-in-out infinite;
  }

  @keyframes float {
    0%,
    100% {
      transform: translateY(0px) rotate(0deg);
    }
    50% {
      transform: translateY(-20px) rotate(180deg);
    }
  }

  .btn-modern {
    border-radius: 25px;
    padding: 12px 24px;
    font-weight: 600;
    transition: all 0.3s ease;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    border: none;
    position: relative;
    overflow: hidden;
  }

  .btn-modern:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 16px rgba(0, 0, 0, 0.2);
  }

  .btn-modern::before {
    content: "";
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(
      90deg,
      transparent,
      rgba(255, 255, 255, 0.2),
      transparent
    );
    transition: left 0.5s ease;
  }

  .btn-modern:hover::before {
    left: 100%;
  }

  .alert {
    border: none;
    border-radius: 12px;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
  }

  /* Custom scrollbar for webkit browsers */
  ::-webkit-scrollbar {
    width: 8px;
  }

  ::-webkit-scrollbar-track {
    background: #f1f1f1;
    border-radius: 10px;
  }

  ::-webkit-scrollbar-thumb {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border-radius: 10px;
  }

  ::-webkit-scrollbar-thumb:hover {
    background: linear-gradient(135deg, #5a6fd8 0%, #6a4190 100%);
  }

  /* Responsive improvements */
  @media (max-width: 768px) {
    .page-header {
      padding: 1.5rem;
      text-align: center;
    }

    .stat-icon {
      width: 60px;
      height: 60px;
      font-size: 1.5rem;
    }

    .category-icon {
      font-size: 2rem;
    }
  }
</style>
{% endblock %} {% block content %}
<!-- Page Header -->
<div class="page-header">
  <div class="d-flex justify-content-between align-items-center">
    <div>
      <h1 class="mb-2"><i class="fas fa-chart-pie"></i> Budget Overview</h1>
      <p class="mb-0 opacity-75">Track and manage your monthly budgets</p>
    </div>
    <a href="{% url 'create_budget' %}" class="btn btn-light btn-modern">
      <i class="fas fa-plus"></i> Create Budget
    </a>
  </div>
</div>

<!-- Budget Summary Cards -->
<div class="row mb-5">
  <div class="col-md-4 mb-3">
    <div class="card gradient-card text-white h-100">
      <div class="card-body d-flex align-items-center">
        <div class="flex-grow-1">
          <h2 class="mb-1">${{ total_budgeted|floatformat:2 }}</h2>
          <p class="mb-0 opacity-75">Total Budgeted</p>
          <small class="opacity-50">Monthly allocation</small>
        </div>
        <div class="stat-icon">
          <i class="fas fa-wallet"></i>
        </div>
      </div>
    </div>
  </div>
  <div class="col-md-4 mb-3">
    <div class="card gradient-card-danger text-white h-100">
      <div class="card-body d-flex align-items-center">
        <div class="flex-grow-1">
          <h2 class="mb-1">${{ total_spent|floatformat:2 }}</h2>
          <p class="mb-0 opacity-75">Total Spent</p>
          <small class="opacity-50">Current month</small>
        </div>
        <div class="stat-icon">
          <i class="fas fa-credit-card"></i>
        </div>
      </div>
    </div>
  </div>
  <div class="col-md-4 mb-3">
    <div
      class="card {% if total_remaining >= 0 %}gradient-card-success{% else %}gradient-card-danger{% endif %} text-white h-100"
    >
      <div class="card-body d-flex align-items-center">
        <div class="flex-grow-1">
          <h2 class="mb-1">${{ total_remaining|floatformat:2 }}</h2>
          <p class="mb-0 opacity-75">
            {% if total_remaining >= 0 %}Remaining{% else %}Over Budget{% endif %}
          </p>
          <small class="opacity-50">
            {% if total_remaining >= 0 %}Available to spend{% else %}Amount exceeded{% endif %}
          </small>
        </div>
        <div class="stat-icon">
          <i
            class="fas {% if total_remaining >= 0 %}fa-thumbs-up{% else %}fa-exclamation-triangle{% endif %}"
          ></i>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Budget Details -->
<div
  class="card border-0"
  style="
    background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
    border-radius: 20px;
    box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
  "
>
  <div
    class="card-header border-0"
    style="background: transparent; padding: 2rem 2rem 1rem"
  >
    <h4 class="mb-0">
      <i class="fas fa-list-alt text-primary"></i> Budget Details for {{
      current_month }}/{{ current_year }}
    </h4>
    <p class="text-muted mt-1 mb-0">
      Monitor your spending across different categories
    </p>
  </div>
  <div class="card-body" style="padding: 1rem 2rem 2rem">
    {% if budgets %}
    <div class="row">
      {% for budget in budgets %}
      <div class="col-lg-6 mb-4">
        <div class="budget-item h-100">
          <div class="p-4">
            <!-- Category Header -->
            <div class="d-flex align-items-center mb-3">
              <div
                class="category-icon me-3"
                style="color: {{ budget.category.color }};"
              >
                {{ budget.category.icon|safe }}
              </div>
              <div class="flex-grow-1">
                <h5 class="mb-1">{{ budget.category.name }}</h5>
                <small class="text-muted"
                  >{{ budget.category.get_category_type_display }}</small
                >
              </div>
              <div class="btn-group btn-group-sm" role="group">
                <a
                  href="{% url 'edit_budget' budget.pk %}"
                  class="btn btn-outline-primary btn-sm"
                  title="Edit Budget"
                >
                  <i class="fas fa-edit"></i>
                </a>
                <a
                  href="{% url 'delete_budget' budget.pk %}"
                  class="btn btn-outline-danger btn-sm"
                  title="Delete Budget"
                >
                  <i class="fas fa-trash"></i>
                </a>
              </div>
            </div>

            <!-- Progress Section -->
            <div class="mb-3">
              <div class="d-flex justify-content-between mb-2">
                <span class="fw-bold"
                  >${{ budget.spent_amount|floatformat:2 }} spent</span
                >
                <span class="text-muted"
                  >of ${{ budget.amount|floatformat:2 }}</span
                >
              </div>
              <div class="progress progress-animated" style="height: 12px">
                <div
                  class="progress-bar progress-bar-animated {% if budget.is_over_budget %}bg-danger{% elif budget.percentage_used > 80 %}bg-warning{% else %}bg-success{% endif %}"
                  role="progressbar"
                  style="width: {% if budget.percentage_used > 100 %}100{% else %}{{ budget.percentage_used }}{% endif %}%"
                  aria-valuenow="{{ budget.percentage_used }}"
                  aria-valuemin="0"
                  aria-valuemax="100"
                >
                  <span class="fw-bold"
                    >{{ budget.percentage_used|floatformat:1 }}%</span
                  >
                </div>
              </div>
            </div>

            <!-- Stats Row -->
            <div class="row text-center">
              <div class="col-4">
                <div class="stat-mini">
                  <div
                    class="h6 mb-0 {% if budget.remaining_amount >= 0 %}text-success{% else %}text-danger{% endif %}"
                  >
                    ${{ budget.remaining_amount|floatformat:2 }}
                  </div>
                  <small class="text-muted">Remaining</small>
                </div>
              </div>
              <div class="col-4">
                <div class="stat-mini">
                  <div class="h6 mb-0 text-info">
                    {{ budget.percentage_used|floatformat:1 }}%
                  </div>
                  <small class="text-muted">Used</small>
                </div>
              </div>
              <div class="col-4">
                <div class="stat-mini">
                  <div class="h6 mb-0 text-primary">
                    {{ budget.transaction_count|default:0 }}
                  </div>
                  <small class="text-muted">Transactions</small>
                </div>
              </div>
            </div>

            <!-- Alerts -->
            {% if budget.is_over_budget %}
            <div
              class="alert alert-danger mt-3 mb-0"
              style="border-radius: 10px"
            >
              <i class="fas fa-exclamation-triangle"></i>
              <strong>Over Budget!</strong> You've exceeded your budget by ${{
              budget.over_budget_amount|floatformat:2 }}.
            </div>
            {% elif budget.percentage_used > 80 %}
            <div
              class="alert alert-warning mt-3 mb-0"
              style="border-radius: 10px"
            >
              <i class="fas fa-exclamation-circle"></i>
              <strong>Budget Warning!</strong> You've used {{
              budget.percentage_used|floatformat:1 }}% of your budget.
            </div>
            {% elif budget.percentage_used > 50 %}
            <div class="alert alert-info mt-3 mb-0" style="border-radius: 10px">
              <i class="fas fa-info-circle"></i>
              <strong>Halfway There!</strong> You're doing well with {{
              budget.percentage_used|floatformat:1 }}% used.
            </div>
            {% endif %}
          </div>
        </div>
      </div>
      {% endfor %}
    </div>
    {% else %}
    <div class="text-center py-5">
      <div
        style="
          background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
          border-radius: 50%;
          width: 100px;
          height: 100px;
          margin: 0 auto 1.5rem;
          display: flex;
          align-items: center;
          justify-content: center;
        "
      >
        <i class="fas fa-chart-pie fa-3x text-white"></i>
      </div>
      <h4 class="text-muted">No Budgets Set</h4>
      <p class="text-muted">
        Create your first budget to start tracking your spending goals and
        improve your financial health.
      </p>
      <a href="{% url 'create_budget' %}" class="btn btn-primary btn-modern">
        <i class="fas fa-plus"></i> Create Your First Budget
      </a>
    </div>
    {% endif %}
  </div>
</div>

{% if budgets %}
<!-- Enhanced Budget Tips -->
<div
  class="card mt-5 border-0"
  style="
    background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
    border-radius: 20px;
    box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
  "
>
  <div
    class="card-header border-0"
    style="background: transparent; padding: 2rem 2rem 1rem"
  >
    <h4 class="mb-0">
      <i class="fas fa-lightbulb text-warning"></i> Smart Budget Tips
    </h4>
    <p class="text-muted mt-1 mb-0">
      Expert advice to improve your financial management
    </p>
  </div>
  <div class="card-body" style="padding: 1rem 2rem 2rem">
    <div class="row">
      <div class="col-lg-4 mb-3">
        <div class="tip-card h-100">
          <div class="card-body text-center">
            <div
              style="
                background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
                border-radius: 50%;
                width: 60px;
                height: 60px;
                margin: 0 auto 1rem;
                display: flex;
                align-items: center;
                justify-content: center;
              "
            >
              <i class="fas fa-target text-white fa-lg"></i>
            </div>
            <h6>Stay on Track</h6>
            <p class="small mb-0">
              Review your budget weekly and adjust spending habits to stay
              within limits. Set alerts for when you reach 75% of your budget.
            </p>
          </div>
        </div>
      </div>
      <div class="col-lg-4 mb-3">
        <div class="tip-card h-100">
          <div class="card-body text-center">
            <div
              style="
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                border-radius: 50%;
                width: 60px;
                height: 60px;
                margin: 0 auto 1rem;
                display: flex;
                align-items: center;
                justify-content: center;
              "
            >
              <i class="fas fa-chart-line text-white fa-lg"></i>
            </div>
            <h6>Track Progress</h6>
            <p class="small mb-0">
              Use the reports section to analyze your spending patterns over
              time and identify areas for improvement.
            </p>
          </div>
        </div>
      </div>
      <div class="col-lg-4 mb-3">
        <div class="tip-card h-100">
          <div class="card-body text-center">
            <div
              style="
                background: linear-gradient(135deg, #fdbb2d 0%, #22c1c3 100%);
                border-radius: 50%;
                width: 60px;
                height: 60px;
                margin: 0 auto 1rem;
                display: flex;
                align-items: center;
                justify-content: center;
              "
            >
              <i class="fas fa-piggy-bank text-white fa-lg"></i>
            </div>
            <h6>Build Emergency Fund</h6>
            <p class="small mb-0">
              Aim to save 3-6 months of expenses for unexpected situations.
              Start with small, consistent contributions.
            </p>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
{% endif %}

<!-- Quick Actions -->
<div
  class="card mt-5 border-0"
  style="
    background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
    border-radius: 20px;
    box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
  "
>
  <div class="card-body" style="padding: 2rem">
    <h5 class="mb-4"><i class="fas fa-bolt text-primary"></i> Quick Actions</h5>
    <div class="row">
      <div class="col-md-3 mb-2">
        <a
          href="{% url 'add_transaction' %}"
          class="btn btn-primary btn-modern w-100"
        >
          <i class="fas fa-plus"></i> Add Transaction
        </a>
      </div>
      <div class="col-md-3 mb-2">
        <a
          href="{% url 'create_budget' %}"
          class="btn btn-success btn-modern w-100"
        >
          <i class="fas fa-chart-pie"></i> New Budget
        </a>
      </div>
      <div class="col-md-3 mb-2">
        <a
          href="{% url 'reports_view' %}"
          class="btn btn-info btn-modern w-100"
        >
          <i class="fas fa-chart-bar"></i> View Reports
        </a>
      </div>
      <div class="col-md-3 mb-2">
        <a
          href="{% url 'category_list' %}"
          class="btn btn-warning btn-modern w-100"
        >
          <i class="fas fa-tags"></i> Manage Categories
        </a>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
  // Enhanced budget progress animation with staggered effect
  document.addEventListener("DOMContentLoaded", function () {
    const progressBars = document.querySelectorAll(
      ".progress-animated .progress-bar"
    );

    // Animate progress bars with stagger
    progressBars.forEach((bar, index) => {
      const width = bar.style.width;
      bar.style.width = "0%";

      setTimeout(() => {
        bar.style.transition = "width 1.5s cubic-bezier(0.4, 0, 0.2, 1)";
        bar.style.width = width;
      }, 300 + index * 200); // Stagger animation
    });

    // Add hover effects to budget items
    const budgetItems = document.querySelectorAll(".budget-item");
    budgetItems.forEach((item) => {
      item.addEventListener("mouseenter", function () {
        this.style.transform = "translateY(-5px) scale(1.02)";
      });

      item.addEventListener("mouseleave", function () {
        this.style.transform = "translateY(0) scale(1)";
      });
    });

    // Animate cards on scroll
    const observerOptions = {
      threshold: 0.1,
      rootMargin: "0px 0px -50px 0px",
    };

    const observer = new IntersectionObserver((entries) => {
      entries.forEach((entry) => {
        if (entry.isIntersecting) {
          entry.target.style.opacity = "1";
          entry.target.style.transform = "translateY(0)";
        }
      });
    }, observerOptions);

    // Observe cards for animation
    document.querySelectorAll(".card, .budget-item").forEach((card) => {
      card.style.opacity = "0";
      card.style.transform = "translateY(20px)";
      card.style.transition = "opacity 0.6s ease, transform 0.6s ease";
      observer.observe(card);
    });

    // Add tooltip functionality
    const tooltipElements = document.querySelectorAll("[title]");
    tooltipElements.forEach((element) => {
      element.addEventListener("mouseenter", function () {
        const tooltip = document.createElement("div");
        tooltip.className = "custom-tooltip";
        tooltip.textContent = this.getAttribute("title");
        tooltip.style.cssText = `
          position: absolute;
          background: rgba(0,0,0,0.8);
          color: white;
          padding: 8px 12px;
          border-radius: 6px;
          font-size: 12px;
          z-index: 1000;
          pointer-events: none;
          opacity: 0;
          transition: opacity 0.3s ease;
        `;
        document.body.appendChild(tooltip);

        const rect = this.getBoundingClientRect();
        tooltip.style.left =
          rect.left + rect.width / 2 - tooltip.offsetWidth / 2 + "px";
        tooltip.style.top = rect.top - tooltip.offsetHeight - 8 + "px";

        setTimeout(() => (tooltip.style.opacity = "1"), 10);

        this.addEventListener(
          "mouseleave",
          function () {
            tooltip.remove();
          },
          { once: true }
        );
      });
    });
  });
</script>
{% endblock %}
